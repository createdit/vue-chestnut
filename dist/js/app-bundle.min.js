!function e(i,t,n){function s(o,r){if(!t[o]){if(!i[o]){var d="function"==typeof require&&require;if(!r&&d)return d(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=t[o]={exports:{}};i[o][0].call(c.exports,function(e){var t=i[o][1][e];return s(t?t:e)},c,c.exports,e,i,t,n)}return t[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,i,t){(function(i){var t,n,s,a,o,r,d,l,c,u,v,f,m,p,h;m=new Wilddog("https://baizhong.wilddogio.com/"),l=m.child("web"),h=l.child("users"),s="undefined"!=typeof window?window.Vue:"undefined"!=typeof i?i.Vue:null,a="undefined"!=typeof window?window.VueAsyncData:"undefined"!=typeof i?i.VueAsyncData:null,s.use(a),o="undefined"!=typeof window?window.VueRouter:"undefined"!=typeof i?i.VueRouter:null,s.use(o),p=new o,s.config.debug=!0,t="183843b1b23f52a7cf28eeefa88b6dff",$.fn.modal.settings.debug=!1,$.fn.dimmer.settings.debug=!1,$.fn.dropdown.settings.debug=!1,$.fn.popup.settings.debug=!1,$.fn.checkbox.settings.debug=!1,r=function(){return this instanceof r?void 0:new r},r.prototype.getToken=function(){var e,i;return e=m.getAuth(),i="",e&&(i=e.token),i},r.prototype.auth=function(){var e;return e=this.getToken(),e||p.replace("/auth"),m.authWithCustomToken(e,function(e,i){return e?p.replace("/auth"):p.replace("/")})},r.prototype.cancel=function(){return m.unauth(),p.replace("/auth")},d=r(),f=e("../tpl/main.jade")(),v=s.extend({template:f,data:function(){return{form:{name:"",tel:"",desc:""},list:{},info:{sms:0},search:"",msg:{status:0,text:""},sort:-1,filter:{send:"",arrived:""}}},computed:{validate:function(){return this.form.name&&this.form.tel&&this.isTel},isTel:function(){return/^\d{11}$/.test(this.form.tel)},searching:function(){return/^\d{3,10}$/.test(this.search)}},events:{closeMsg:function(){return $(".bz-message").transition({animation:"fade down",duration:300})}},methods:{submit:function(){var e,i,t,n,s;return n=this,e=new Date,s=e.getFullYear(),t=e.getMonth()+1,i=s+"/"+t+"/"+e.getDate(),h.push({name:n.form.name,tel:n.form.tel,date:i,visitDate:i,desc:n.form.desc,sent:!1,arrive:!1}),h.once("child_added",function(e){return n.form.name="",n.form.tel="",n.form.desc=""})},sms:function(e,i){var t;return t=this,this.disabled?!1:(this.disabled=!0,$.ajax({method:"POST",url:"/api/sendSMS",data:{mobile:e.tel},dataType:"json",success:function(e){var n;return 0===e.code?(t.info.sms=t.info.sms-1,n=h.child(i),n.update({sent:!0}),t.msg.status=1):(t.msg.status=0,t.msg.text=e.msg)},error:function(){return t.msg.status=2},complete:function(){return t.disabled=!1,$(".bz-message").transition({animation:"fade down",duration:300}),setTimeout(function(){return t.$emit("closeMsg")},3e3)}}))},del:function(e){return $(".ui.modal").modal("show"),this.$once("row-del",function(){var i;return i=h.child(e),i.remove()})},confirm:function(){return this.$emit("row-del")},modify:function(e,i){var t;return e.editable=!e.editable,e.editable===!1?(t=h.child(i),t.update({name:e.name,tel:e.tel,desc:e.desc,visitDate:e.visitDate})):void 0},attendance:function(e,i,t){var n;return n=h.child(i),n.update({arrive:!0}),$(t.target).parents(".ui.dropdown").dropdown("hide")},messageClose:function(){return this.$emit("closeMsg")},logout:function(){return d.cancel()},noticeCtrl:function(){return this.$broadcast("toggleNotice")},searchLike:function(){var e;e=this.search,this.searching&&$.each(this.list,function(i,t){var n,s;t.tel.indexOf(e)>=0?(n=t.tel.match(e),s='<span class="searchSelect">'+n[0]+"</span>",t.telClone=t.tel.replace(n[0],s)):t.telClone=""})},sortList:function(){return 1===this.sort?this.sort=-1:this.sort=1}},asyncData:function(e){var i;return i=this,h.on("value",function(i){var t,n;return n=i.val(),n&&!$.isEmptyObject(n)&&$.each(n,function(e,i){return i.editable=!1,i.telClone="",i.disabled=!1,!0}),e({list:n}),t=function(){return $(".ui.dropdown").dropdown({action:"hide"})},setTimeout(t,0)})},created:function(){var e;return d.auth(),e=this,$.ajax({url:"/api/account",dataType:"json",success:function(i){return 0===i.code?e.info.sms=i.user.balance:void 0}})},ready:function(){var e;return e=this,$("[data-content]").popup(),$("#filterSend").checkbox({onChange:function(){return e.filter.send===!1?e.filter.send="":e.filter.send=!1}}),$("#filterArrived").checkbox({onChange:function(){return e.filter.arrived===!1?e.filter.arrived="":e.filter.arrived=!1}})},components:{notice:e("../tpl/notice.vue")}}),u=e("../tpl/login.jade")(),c=s.extend({template:u,data:function(){return{loginError:!1,email:"",password:""}},methods:{login:function(){var e,i;return this.email&&this.password?(e=function(e,t){return null===e?p.replace("/"):i.loginError=!0},i=this,m.authWithPassword({email:i.email,password:i.password},e)):void(this.loginError=!0)}},created:function(){return d.auth()}}),p.map({"/":{component:v},"/auth":{component:c}}),n=s.extend({}),p.start(n,"#app")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tpl/login.jade":2,"../tpl/main.jade":3,"../tpl/notice.vue":4}],2:[function(e,i,t){e("jade/runtime");i.exports=function(e){var i=[];return i.push('<style>body {\n    background-color: #DADADA;\n}\nbody > .grid {\n    height: 100%;\n}\n.column {\n    max-width: 450px;\n}</style><div class="ui middle aligned center aligned grid"><div class="column"><h2 class="ui teal header"><div class="content">验证你的身份</div></h2><form v-bind:class="{\'error\': loginError}" class="ui large form"><div class="ui stacked segment"><div class="field"><div class="ui left icon input"><div class="user icon"></div><input type="text" placeholder="邮箱" v-model="email"/></div></div><div class="field"><div class="ui left icon input"><div class="lock icon"></div><input type="password" placeholder="密码" v-model="password"/></div></div><div v-on:click="login" class="ui fluid large teal submit button">登录</div></div><div class="ui error message">账号或密码有误</div></form></div></div>'),i.join("")}},{"jade/runtime":6}],3:[function(e,i,t){e("jade/runtime");i.exports=function(e){var i=[];return i.push('<div v-on:click="messageClose" v-bind:class="{\'positive\': msg.status == 1, \'negative\': msg.status == 0, \'transition\': true, \'hidden\': true}" class="ui compact message bz-message"><i class="close icon"></i><p v-if="msg.status == 0">{{msg.text}}！</p><p v-if="msg.status == 1">短信发送成功！</p><p v-if="msg.status == 2">网络错误，请稍后再试！</p></div><div class="ui container"><header><div class="ui grid"><div class="twelve wide column"><h1 class="ui header"> <i class="doctor icon"></i>百忠牙科</h1></div><div class="four wide column"><div v-on:click="logout" data-content="登出" class="ui icon button bz-logout"><i class="sign out icon"></i></div><div v-on:click="noticeCtrl" data-content="消息" class="ui icon button bz-notice-btn"><i class="announcement icon"></i></div></div></div></header><div class="ui green label sms-count">可用短信<div class="detail">{{info.sms}}</div></div><notice></notice><div class="section"><h3 class="ui dividing header">新增客户资料</h3><div v-bind:class="{\'error\': !validate}" class="ui form"><div class="two fields"><div class="field"><label>姓名</label><input type="text" v-model="form.name"/></div><div class="field"><label>电话</label><input type="text" v-model="form.tel"/></div></div><div class="field"><label>备注</label><textarea rows="2" v-model="form.desc"></textarea></div><div v-on:click="submit" v-bind:class="{\'disabled\':!validate}" class="button ui blue button">提交</div><div class="ui error message"><ul class="list"><li v-if="!form.name">请输入姓名</li><li v-if="!form.tel">请输入手机号码</li><li v-if="!isTel &amp;&amp; form.tel">你输入的手机号码有误</li></ul></div></div></div><div class="section"><h3 class="ui dividing header">客户列表</h3><div class="table-control"><div class="ui left icon input user-search"><input type="text" placeholder="搜索姓名或手机号码..." v-model="search" v-on:input="searchLike" v-on:blur="search = \'\'"/><i class="users icon"></i></div><button v-on:click="sortList" data-content="排序" class="ui icon button sort-button"><i v-show="sort == 1" class="sort numeric ascending icon"></i><i v-show="sort == -1" class="sort numeric descending icon"></i></button><div id="filterSend" class="ui checkbox"><input type="checkbox" name="send" tabindex="0" class="hidden"/><label>未通知</label></div><div id="filterArrived" class="ui checkbox"><input type="checkbox" name="arrived" tabindex="0" class="hidden"/><label>未到诊</label></div></div><table class="ui very basic right aligned table user-list"><thead><tr><th> <span class="date-tags">登记/来访</span></th><th>姓名</th><th>电话</th><th>备注</th><th>编辑</th><th>功能</th><th>通知</th><th>到诊</th></tr></thead><tbody><tr v-for="item in list | orderBy \'visitDate\' sort | filterBy filter.send in \'sent\' | filterBy filter.arrived in \'arrive\'" v-bind:class="{\'positive\':item.name == search || item.tel == search}"><td> <div class="date-tags">{{item.date}}</div><div v-show="!item.editable">{{item.visitDate}}</div><div v-show="item.editable" class="ui input"><input type="text" v-model="item.visitDate"/></div></td><td><div v-show="item.editable" class="ui input"><input type="text" v-model="item.name"/></div><div v-show="!item.editable">{{item.name}}</div></td><td><div v-show="item.editable" class="ui input"><input type="text" v-model="item.tel"/></div><div v-show="!item.editable"><span v-show="!item.telClone || !searching">{{item.tel}}</span><div v-html="item.telClone" v-show="item.telClone &amp;&amp; searching"></div></div></td><td><div v-show="!item.editable"><template v-if="!item.desc">...</template><template v-else="v-else">{{item.desc}}</template></div><div v-show="item.editable" class="ui form"><div class="field"><textarea rows="2" v-model="item.desc"></textarea></div></div></td><td><div class="ui icon bottom left pointing dropdown button"><i class="write icon"></i><div class="menu"><div v-on:click="del($key)" class="item"> <i class="remove icon"></i><span class="text">删除</span></div><div v-on:click="modify(item, $key)" class="item"><i class="edit icon"></i><span v-if="!item.editable" class="text">修改</span><span v-else="v-else" class="text">保存</span></div></div></div></td><td><div class="ui icon bottom left pointing dropdown button"><i class="wrench icon"></i><div class="menu"><div v-on:click="sms(item, $key)" class="item"><i class="mail outline icon"></i><span class="text">短信</span></div><div v-on:click="attendance(item, $key, $event)" class="item"><i class="flag icon"></i><span class="text">到诊</span></div></div></div></td><td><i v-if="item.sent" class="checkmark green icon"></i><i v-else="v-else" class="remove red icon"></i></td><td><i v-if="item.arrive" class="checkmark green icon"></i><i v-else="v-else" class="remove red icon"></i></td></tr></tbody></table></div><div class="ui small basic modal"><div class="ui icon header"><i class="archive icon"></i>删除数据？</div><div class="content"><p>数据删除不可恢复，是否要删除本条数据？</p></div><div class="actions"><div class="ui red basic cancel inverted button"><i class="remove icon"></i>No</div><div v-on:click="confirm" class="ui green ok inverted button"><i class="checkmark icon"></i>Yes</div></div></div></div>'),i.join("")}},{"jade/runtime":6}],4:[function(e,i,t){var n='<div v-bind:class="{\'hidden\': isShow == 0}" class="ui icon message trantison update-message"><i class="close icon"></i><div class="content"><div class="header">更新啦！！！</div><div class="ui list"><div class="item"><div class="header">2015年11月30日</div>修复无法连续发信息bug。</div><div class="item">增加<div class="ui mini label">排序</div>按钮</div><div class="item">增加<div class="ui mini label">过滤</div></div><div class="item"><div class="header">2015年11月13日</div>手机号支持模糊搜索，输入三位以上数字。e.g.<span class="italic">0452</span>,<span class="italic">137</span></div><div class="item">更新通知只会在第一次访问时显示，如需查看请点右上角<div class="ui mini label">通知</div>按钮</div><div class="item">点击发送短信后，右上会显示发送状态。</div><div class="item"><div class="header">2015年11月12日</div>新增来访日期，默认为登记日期，如需更改请点<div class="ui mini label">编辑</div>-<div class="ui mini label">修改</div>。</div><div class="item">新增搜索功能，暂时只支持严格匹配(全名或完整的手机号)。e.g.<span class="italic">王大锤</span>,<span class="italic">13804528888</span></div></div></div></div>';i.exports={data:function(){return{isShow:1}},events:{toggle:function(){this.isShow=!this.isShow}},ready:function(){return $.cookie("notice")&&(this.isShow=parseInt($.cookie("notice"),10)),$(this.$el).find(".close").on("click",function(){return $(this).closest(".message").transition("fade"),$.cookie("notice",0)}),this.$on("toggleNotice",function(){this.$emit("toggle")})}},("function"==typeof i.exports?i.exports.options:i.exports).template=n},{}],5:[function(e,i,t){},{}],6:[function(e,i,t){(function(n){!function(e){if("object"==typeof t&&"undefined"!=typeof i)i.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof n?n:"undefined"!=typeof self?self:this,s.jade=e()}}(function(){return function i(t,n,s){function a(r,d){if(!n[r]){if(!t[r]){var l="function"==typeof e&&e;if(!d&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var i=t[r][1][e];return a(i?i:e)},u,u.exports,i,t,n,s)}return n[r].exports}for(var o="function"==typeof e&&e,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,i,t){"use strict";function n(e){return null!=e&&""!==e}function s(e){return(Array.isArray(e)?e.map(s):e&&"object"==typeof e?Object.keys(e).filter(function(i){return e[i]}):[e]).filter(n).join(" ")}function a(e){return r[e]||e}function o(e){var i=String(e).replace(d,a);return i===""+e?e:i}t.merge=function l(e,i){if(1===arguments.length){for(var t=e[0],s=1;s<e.length;s++)t=l(t,e[s]);return t}var a=e["class"],o=i["class"];(a||o)&&(a=a||[],o=o||[],Array.isArray(a)||(a=[a]),Array.isArray(o)||(o=[o]),e["class"]=a.concat(o).filter(n));for(var r in i)"class"!=r&&(e[r]=i[r]);return e},t.joinClasses=s,t.cls=function(e,i){for(var n=[],a=0;a<e.length;a++)i&&i[a]?n.push(t.escape(s([e[a]]))):n.push(s(e[a]));var o=s(n);return o.length?' class="'+o+'"':""},t.style=function(e){return e&&"object"==typeof e?Object.keys(e).map(function(i){return i+":"+e[i]}).join(";"):e},t.attr=function(e,i,n,s){return"style"===e&&(i=t.style(i)),"boolean"==typeof i||null==i?i?" "+(s?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof i?(-1!==JSON.stringify(i).indexOf("&")&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),i&&"function"==typeof i.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+e+"='"+JSON.stringify(i).replace(/'/g,"&apos;")+"'"):n?(i&&"function"==typeof i.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+t.escape(i)+'"'):(i&&"function"==typeof i.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+i+'"')},t.attrs=function(e,i){var n=[],a=Object.keys(e);if(a.length)for(var o=0;o<a.length;++o){var r=a[o],d=e[r];"class"==r?(d=s(d))&&n.push(" "+r+'="'+d+'"'):n.push(t.attr(r,d,!1,i))}return n.join("")};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},d=/[&<>"]/g;t.escape=o,t.rethrow=function c(i,t,n,s){if(!(i instanceof Error))throw i;if(!("undefined"==typeof window&&t||s))throw i.message+=" on line "+n,i;try{s=s||e("fs").readFileSync(t,"utf8")}catch(a){c(i,null,n)}var o=3,r=s.split("\n"),d=Math.max(n-o,0),l=Math.min(r.length,n+o),o=r.slice(d,l).map(function(e,i){var t=i+d+1;return(t==n?"  > ":"    ")+t+"| "+e}).join("\n");throw i.path=t,i.message=(t||"Jade")+":"+n+"\n"+o+"\n\n"+i.message,i},t.DebugItem=function(e,i){this.lineno=e,this.filename=i}},{fs:2}],2:[function(e,i,t){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{fs:5}]},{},[1]);